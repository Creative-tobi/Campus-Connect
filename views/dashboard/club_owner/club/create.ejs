<!-- This file uses the layout.ejs -->
<% title = 'Create Club | CampusConnect' %> <% userRole = 'club_owner' %> <%
const body = `
<div class="max-w-2xl mx-auto">
  <div class="bg-white rounded-lg shadow p-6">
    <h1 class="text-xl font-bold text-gray-900 mb-6">Create a New Club</h1>
    <form id="createClubForm">
      <div class="mb-4">
        <label for="name" class="block text-sm font-medium text-gray-700"
          >Club Name *</label
        >
        <input
          type="text"
          id="name"
          name="name"
          required
          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" />
      </div>

      <div class="mb-4">
        <label for="description" class="block text-sm font-medium text-gray-700"
          >Description *</label
        >
        <textarea
          id="description"
          name="description"
          rows="4"
          required
          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"></textarea>
      </div>

      <div class="mb-4">
        <label for="category" class="block text-sm font-medium text-gray-700"
          >Category *</label
        >
        <select
          id="category"
          name="category"
          required
          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
          <option value="">Select a category</option>
          <option value="academic">Academic</option>
          <option value="sports">Sports</option>
          <option value="tech">Technology</option>
          <option value="arts">Arts & Culture</option>
          <option value="social">Social</option>
          <!-- Add more categories as needed -->
        </select>
      </div>

      <div class="mb-6">
        <label for="logo" class="block text-sm font-medium text-gray-700"
          >Club Logo (Optional)</label
        >
        <input
          type="file"
          id="logo"
          name="logo"
          accept="image/*"
          class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" />
      </div>

      <div class="mb-6">
        <label for="banner" class="block text-sm font-medium text-gray-700"
          >Club Banner (Optional)</label
        >
        <input
          type="file"
          id="banner"
          name="banner"
          accept="image/*"
          class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" />
      </div>

      <div class="flex justify-end">
        <button
          type="submit"
          class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium">
          Create Club
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  document
    .getElementById("createClubForm")
    .addEventListener("submit", async function (e) {
      e.preventDefault();

      const formData = new FormData(this);

      try {
        const response = await fetch("/api/clubs", {
          method: "POST",
          body: formData, // Use FormData to send files and text
          headers: {
            Authorization: "Bearer " + sessionStorage.getItem("token"), // Assuming token is stored in sessionStorage
          },
        });

        if (response.ok) {
          const result = await response.json();
          alert("Club created successfully! Awaiting admin approval.");
          // Redirect to dashboard or my clubs page
          window.location.href = "/api/clubs/my";
        } else {
          const errorData = await response.json();
          alert("Error: " + errorData.error);
        }
      } catch (error) {
        console.error("Error creating club:", error);
        alert("An error occurred while creating the club.");
      }
    });
</script>
` %>
<%- include('../../layout', { title: title, userRole: userRole, body: body }) %>
