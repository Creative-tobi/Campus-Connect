<!-- This file uses the layout.ejs -->
<% title = 'Edit Club | CampusConnect' %>
<% userRole = 'club_owner' %>


<% const body = `
<div class="max-w-2xl mx-auto">
    <div class="bg-white rounded-lg shadow p-6">
        <h1 class="text-xl font-bold text-gray-900 mb-6">Edit Club Details</h1>
        <form id="editClubForm">
            <div class="mb-4">
                <label for="name" class="block text-sm font-medium text-gray-700">Club Name *</label>
                <input type="text" id="name" name="name" value="` + (typeof club !== 'undefined' ? club.name : '') + `" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
            </div>

            <div class="mb-4">
                <label for="description" class="block text-sm font-medium text-gray-700">Description *</label>
                <textarea id="description" name="description" rows="4" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">` + (typeof club !== 'undefined' ? club.description : '') + `</textarea>
            </div>

            <div class="mb-4">
                <label for="category" class="block text-sm font-medium text-gray-700">Category *</label>
                <select id="category" name="category" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    <option value="academic" ` + (typeof club !== 'undefined' && club.category === 'academic' ? 'selected' : '') + `>Academic</option>
                    <option value="sports" ` + (typeof club !== 'undefined' && club.category === 'sports' ? 'selected' : '') + `>Sports</option>
                    <option value="tech" ` + (typeof club !== 'undefined' && club.category === 'tech' ? 'selected' : '') + `>Technology</option>
                    <option value="arts" ` + (typeof club !== 'undefined' && club.category === 'arts' ? 'selected' : '') + `>Arts & Culture</option>
                    <option value="social" ` + (typeof club !== 'undefined' && club.category === 'social' ? 'selected' : '') + `>Social</option>
                </select>
            </div>

            <div class="mb-6">
                <label for="logo" class="block text-sm font-medium text-gray-700">Update Logo (Optional)</label>
                <input type="file" id="logo" name="logo" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
            </div>

            <div class="mb-6">
                <label for="banner" class="block text-sm font-medium text-gray-700">Update Banner (Optional)</label>
                <input type="file" id="banner" name="banner" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
            </div>

            <div class="flex justify-between">
                <button type="button" id="cancelBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md text-sm font-medium">
                    Cancel
                </button>
                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                    Save Changes
                </button>
            </div>
        </form>
    </div>
</div>

<script>
const clubId = '<%= typeof club !== "undefined" ? club._id : "" %>';

    document.getElementById('editClubForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const formData = new FormData(this);

        try {
            const response = await fetch(`/api/clubs/${clubId}/`, {
                method: 'PUT',
                body: formData,
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            });

            if (response.ok) {
                const result = await response.json();
                alert('Club updated successfully!');
                window.location.href = `/api/clubs/${clubId}/`; // Redirect back to club detail
            } else {
                const errorData = await response.json();
                alert('Error: ' + errorData.error);
            }
        } catch (error) {
            console.error('Error updating club:', error);
            alert('An error occurred while updating the club.');
        }
    });

    document.getElementById('cancelBtn').addEventListener('click', function() {
        window.location.href = `/api/clubs/${clubId}/`; // Redirect back without saving
    });
</script>
` %>
<%- include('../../layout', { title: title, userRole: userRole, body: body }) %>