<!-- This file uses the layout.ejs -->
<% title = 'Admin Dashboard | CampusConnect' %> <% userRole = 'admin' %>
<!-- <%- include('../layout', { title: title, userRole: userRole, body: body }) %> -->

<% const body = `
<div class="max-w-6xl mx-auto">
  <div class="bg-white rounded-lg shadow p-6 mb-6">
    <h1 class="text-xl font-bold text-gray-900">Admin Dashboard</h1>
    <p class="text-gray-600">Manage users, clubs, and content.</p>
  </div>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
    <div class="bg-white rounded-lg shadow p-4">
      <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">
        Total Users
      </h3>
      <p id="totalUsers" class="text-2xl font-bold text-blue-600">Loading...</p>
    </div>
    <div class="bg-white rounded-lg shadow p-4">
      <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">
        Total Clubs
      </h3>
      <p id="totalClubs" class="text-2xl font-bold text-green-600">
        Loading...
      </p>
    </div>
    <div class="bg-white rounded-lg shadow p-4">
      <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">
        Total Posts
      </h3>
      <p id="totalPosts" class="text-2xl font-bold text-purple-600">
        Loading...
      </p>
    </div>
    <div class="bg-white rounded-lg shadow p-4">
      <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">
        Pending Clubs
      </h3>
      <p id="pendingClubs" class="text-2xl font-bold text-yellow-600">
        Loading...
      </p>
    </div>
    <div class="bg-white rounded-lg shadow p-4">
      <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">
        Total Notifications
      </h3>
      <p id="totalNotifications" class="text-2xl font-bold text-gray-600">
        Loading...
      </p>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    <a
      href="/api/admin/users"
      class="bg-white rounded-lg shadow p-4 text-center hover:bg-gray-50">
      <i class="fas fa-users text-blue-500 text-2xl mb-2"></i>
      <h3 class="font-medium text-gray-900">Manage Users</h3>
    </a>
    <a
      href="/api/admin/clubs"
      class="bg-white rounded-lg shadow p-4 text-center hover:bg-gray-50">
      <i class="fas fa-chalkboard text-green-500 text-2xl mb-2"></i>
      <h3 class="font-medium text-gray-900">Manage Clubs</h3>
    </a>
    <a
      href="/api/admin/posts"
      class="bg-white rounded-lg shadow p-4 text-center hover:bg-gray-50">
      <i class="fas fa-comments text-purple-500 text-2xl mb-2"></i>
      <h3 class="font-medium text-gray-900">Manage Posts</h3>
    </a>
  </div>

  <!-- Recent Activity (Notifications) -->
  <div class="bg-white rounded-lg shadow p-6">
    <h2 class="text-lg font-semibold text-gray-900 mb-4">Recent Activity</h2>
    <div id="recentActivityList">
      <p class="text-gray-500">Loading activity...</p>
    </div>
  </div>
</div>

<script>
  // Example: Fetch dashboard stats
  async function loadDashboardStats() {
    try {
      const response = await fetch("/api/admin/dashboard", {
        headers: {
          Authorization: "Bearer " + sessionStorage.getItem("token"), // Assuming token is stored in sessionStorage
        },
      });
      if (!response.ok) throw new Error("Failed to fetch stats");
      const data = await response.json();

      document.getElementById("totalUsers").textContent = data.stats.totalUsers;
      document.getElementById("totalClubs").textContent = data.stats.totalClubs;
      document.getElementById("totalPosts").textContent = data.stats.totalPosts;
      document.getElementById("pendingClubs").textContent =
        data.stats.pendingClubs;
      document.getElementById("totalNotifications").textContent =
        data.stats.totalNotifications;
    } catch (error) {
      console.error("Error loading stats:", error);
      // Handle error display for stats if needed
    }
  }

  // Example: Fetch recent notifications (activity)
  async function loadRecentActivity() {
    try {
      const response = await fetch("/api/notifications", {
        headers: {
          Authorization: "Bearer " + sessionStorage.getItem("token"),
        },
      });
      if (!response.ok) throw new Error("Failed to fetch notifications");
      const data = await response.json();
      const container = document.getElementById("recentActivityList");
      container.innerHTML = ""; // Clear loading message

      if (data.notifications && data.notifications.length > 0) {
        data.notifications.slice(0, 5).forEach((notification) => {
          // Show only first 5
          const activityDiv = document.createElement("div");
          activityDiv.className =
            "border-b border-gray-200 pb-3 mb-3 last:border-0 last:mb-0"; // Add border between items
          activityDiv.innerHTML = `\
                        <div class="flex items-start">
                            <div class="bg-gray-200 border-2 border-dashed rounded-xl w-8 h-8 mr-3"></div> <!-- Icon placeholder -->
                            <div class="flex-1">
                                <p class="text-sm text-gray-800">${
                                  notification.message
                                }</p>
                                <p class="text-xs text-gray-500">${new Date(
                                  notification.createdAt
                                ).toLocaleString()}</p>
                                ${
                                  !notification.read
                                    ? '<span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full mt-1">New</span>'
                                    : ""
                                }
                            </div>
                        </div>
                    `;
          container.appendChild(activityDiv);
        });
      } else {
        container.innerHTML =
          '<p class="text-gray-500">No recent activity.</p>';
      }
    } catch (error) {
      console.error("Error loading activity:", error);
      document.getElementById("recentActivityList").innerHTML =
        '<p class="text-red-500">Error loading activity.</p>';
    }
  }

  // Load stats and activity when page loads
  document.addEventListener("DOMContentLoaded", () => {
    loadDashboardStats();
    loadRecentActivity();
  });
</script>
` %> <%- include('../layout', { title: title, userRole: userRole, body: body })
%>
