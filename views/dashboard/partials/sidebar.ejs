<% const userData = typeof user !== 'undefined' ? user : (typeof window !==
'undefined' ? getUserData() : null); %> <% const userRole = userData ?
userData.role : 'user'; %> <% const userId = userData ? userData._id : ''; %>

<aside
  id="sidebar"
  class="fixed inset-y-0 left-0 z-40 w-64 bg-white shadow-lg transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out md:static md:inset-0">
  <div class="h-full overflow-y-auto">
    <nav class="px-3 py-4">
      <ul class="space-y-2">
        <li>
          <a
            href="/api/users/dashboard"
            class="flex items-center p-2 text-gray-900 rounded-lg hover:bg-gray-100 group">
            <i class="fas fa-home text-gray-500 group-hover:text-gray-900"></i>
            <span class="ml-3">Home</span>
          </a>
        </li>
        <li>
          <a
            href="/api/users/clubs"
            class="flex items-center p-2 text-gray-900 rounded-lg hover:bg-gray-100 group">
            <i class="fas fa-users text-gray-500 group-hover:text-gray-900"></i>
            <span class="ml-3">Clubs</span>
          </a>
        </li>
        <li>
          <a
            href="/api/users/notifications"
            class="flex items-center p-2 text-gray-900 rounded-lg hover:bg-gray-100 group relative">
            <i class="fas fa-bell text-gray-500 group-hover:text-gray-900"></i>
            <span class="ml-3">Notifications</span>
            <!-- Example notification badge (will be updated by JS) -->
            <span
              id="sidebar-notification-badge"
              class="hidden absolute right-4 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center"
              >0</span
            >
          </a>
        </li>
        <li>
          <a
            href="/api/users/profile"
            class="flex items-center p-2 text-gray-900 rounded-lg hover:bg-gray-100 group">
            <i class="fas fa-user text-gray-500 group-hover:text-gray-900"></i>
            <span class="ml-3">Profile</span>
          </a>
        </li>
        <!-- Club Owner Specific Links -->
        <% if (userRole === 'club_owner') { %>
        <li class="mt-4">
          <h3
            class="px-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">
            Club Owner
          </h3>
        </li>
        <li>
          <a
            href="/api/clubs/my"
            class="flex items-center p-2 text-gray-900 rounded-lg hover:bg-gray-100 group">
            <i
              class="fas fa-chalkboard-teacher text-gray-500 group-hover:text-gray-900"></i>
            <span class="ml-3">My Clubs</span>
          </a>
        </li>
        <li>
          <a
            href="/api/clubs/create"
            class="flex items-center p-2 text-gray-900 rounded-lg hover:bg-gray-100 group">
            <i
              class="fas fa-plus-circle text-gray-500 group-hover:text-gray-900"></i>
            <span class="ml-3">Create Club</span>
          </a>
        </li>
        <% } %>
        <!-- Admin Specific Links -->
        <% if (userRole === 'admin') { %>
        <li class="mt-4">
          <h3
            class="px-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">
            Admin
          </h3>
        </li>
        <li>
          <a
            href="/api/admin/dashboard"
            class="flex items-center p-2 text-gray-900 rounded-lg hover:bg-gray-100 group">
            <i class="fas fa-cog text-gray-500 group-hover:text-gray-900"></i>
            <span class="ml-3">Admin Dashboard</span>
          </a>
        </li>
        <li>
          <a
            href="/api/admin/users"
            class="flex items-center p-2 text-gray-900 rounded-lg hover:bg-gray-100 group">
            <i class="fas fa-users text-gray-500 group-hover:text-gray-900"></i>
            <span class="ml-3">Manage Users</span>
          </a>
        </li>
        <li>
          <a
            href="/api/admin/clubs"
            class="flex items-center p-2 text-gray-900 rounded-lg hover:bg-gray-100 group">
            <i
              class="fas fa-chalkboard text-gray-500 group-hover:text-gray-900"></i>
            <span class="ml-3">Manage Clubs</span>
          </a>
        </li>
        <li>
          <a
            href="/api/admin/posts"
            class="flex items-center p-2 text-gray-900 rounded-lg hover:bg-gray-100 group">
            <i
              class="fas fa-comments text-gray-500 group-hover:text-gray-900"></i>
            <span class="ml-3">Manage Posts</span>
          </a>
        </li>
        <% } %>
      </ul>
    </nav>
  </div>
</aside>

<script>
  // Example: Fetch notification count for sidebar badge
  async function fetchSidebarNotificationCount() {
    try {
      const response = await fetch("/api/notifications?read=false&limit=1", {
        // Fetch only unread count efficiently
        headers: {
          Authorization: "Bearer " + localStorage.getItem("token"),
        },
      });
      if (response.ok) {
        const data = await response.json();
        const unreadCount = data.notifications ? data.notifications.length : 0; // Or get count from pagination if available
        const badge = document.getElementById("sidebar-notification-badge");
        if (unreadCount > 0) {
          badge.textContent = unreadCount;
          badge.classList.remove("hidden");
        } else {
          badge.classList.add("hidden");
        }
      }
    } catch (error) {
      console.error("Error fetching sidebar notification count:", error);
      document
        .getElementById("sidebar-notification-badge")
        .classList.add("hidden"); // Hide on error
    }
  }

  // Load initial count for sidebar badge
  document.addEventListener("DOMContentLoaded", fetchSidebarNotificationCount);
  // Optionally, refresh count every 30 seconds or so
  // setInterval(fetchSidebarNotificationCount, 30000);
</script>
