<%- include('../../partials/header') %>

<div class="container mx-auto px-4 py-8">
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-800">Admin Dashboard</h1>
    <p class="text-gray-500">System Overview & Statistics</p>
  </div>

  <div
    id="stats-container"
    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="bg-white p-6 rounded-lg shadow border animate-pulse h-32"></div>
    <div class="bg-white p-6 rounded-lg shadow border animate-pulse h-32"></div>
    <div class="bg-white p-6 rounded-lg shadow border animate-pulse h-32"></div>
    <div class="bg-white p-6 rounded-lg shadow border animate-pulse h-32"></div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
    <div class="bg-white p-6 rounded-lg shadow border">
      <h3 class="font-bold text-lg mb-4">Pending Approvals</h3>
      <p class="text-gray-600 mb-4">
        Review new club requests needing your attention.
      </p>
      <a
        href="/api/admin/clubs?status=pending"
        class="token-link inline-block bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
        Go to Approvals
      </a>
    </div>
    <div class="bg-white p-6 rounded-lg shadow border">
      <h3 class="font-bold text-lg mb-4">Club Management</h3>
      <p class="text-gray-600 mb-4">
        View all clubs and manage them including deletion.
      </p>
      <a
        href="/api/admin/clubs"
        class="token-link inline-block bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
        Manage Clubs
      </a>
    </div>
    <div class="bg-white p-6 rounded-lg shadow border">
      <h3 class="font-bold text-lg mb-4">Post Management</h3>
      <p class="text-gray-600 mb-4">
        View all posts and manage them including deletion.
      </p>
      <a
        href="/api/admin/posts"
        class="token-link inline-block bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
        Manage Posts
      </a>
    </div>
    <div class="bg-white p-6 rounded-lg shadow border">
      <h3 class="font-bold text-lg mb-4">User Management</h3>
      <p class="text-gray-600 mb-4">
        Manage users, roles, and account statuses.
      </p>
      <a
        href="/api/admin/users"
        class="token-link inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
        Manage Users
      </a>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const token = localStorage.getItem("token");
    if (!token) return (window.location.href = "/api/auth/login");

    try {
      // Fetch stats from the specific data endpoint
      const res = await fetch("/api/admin/dashboard/data", {
        headers: { Authorization: `Bearer ${token}` },
      });

      if (!res.ok) throw new Error("Failed to load stats");

      const data = await res.json();
      const stats = data.stats;

      const container = document.getElementById("stats-container");
      container.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow border border-l-4 border-l-blue-500">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-gray-500 text-sm">Total Users</p>
                            <h2 class="text-3xl font-bold text-gray-800">${stats.totalUsers}</h2>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-full text-blue-600">
                            <i class="fas fa-users text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow border border-l-4 border-l-green-500">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-gray-500 text-sm">Active Clubs</p>
                            <h2 class="text-3xl font-bold text-gray-800">${stats.totalClubs}</h2>
                        </div>
                        <div class="bg-green-100 p-3 rounded-full text-green-600">
                            <i class="fas fa-building text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow border border-l-4 border-l-yellow-500">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-gray-500 text-sm">Pending Approval</p>
                            <h2 class="text-3xl font-bold text-gray-800">${stats.pendingClubs}</h2>
                        </div>
                        <div class="bg-yellow-100 p-3 rounded-full text-yellow-600">
                            <i class="fas fa-hourglass-half text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow border border-l-4 border-l-purple-500">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-gray-500 text-sm">Total Posts</p>
                            <h2 class="text-3xl font-bold text-gray-800">${stats.totalPosts}</h2>
                        </div>
                        <div class="bg-purple-100 p-3 rounded-full text-purple-600">
                            <i class="fas fa-newspaper text-xl"></i>
                        </div>
                    </div>
                </div>
            `;
    } catch (error) {
      console.error(error);
      alert("Error loading dashboard data");
    }
  });
</script>

<%- include('../../partials/footer') %>
